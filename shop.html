<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸Šå•†åŸ | å¸ƒå¶æ—¥å’Œ</title>
    <link rel="icon" href="logo.png" type="image/png">
    <style>
        @font-face { font-family: 'OpenHuninn'; src: url('jf-openhuninn-2.0.ttf') format('truetype'); }
        :root {
            --color-purple: #cdb4db; --color-pink-light: #ffc8dd; --color-pink-hot: #ffafcc;
            --color-blue-light: #bde0fe; --text-color: #5a4a4a;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'OpenHuninn', sans-serif; margin: 0; padding: 0;
            background-color: #fdf0f5; color: var(--text-color);
            padding-bottom: 100px;
        }

        /* Header & Back Link */
        header {
            background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100;
        }
        .back-link { text-decoration: none; color: var(--text-color); font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .page-title { color: var(--color-pink-hot); font-weight: bold; font-size: 1.2rem; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Grid Layout */
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        @media(min-width: 768px) { .shop-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; } }

        .product-card { 
            background: white; border-radius: 15px; padding: 10px; border: 2px solid #eee; transition: 0.3s; 
            cursor: pointer; display: flex; flex-direction: column;
        }
        .product-card:hover { border-color: var(--color-pink-hot); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .product-img { width: 100%; aspect-ratio: 1/1; background: #f9f9f9; border-radius: 10px; margin-bottom: 10px; object-fit: cover; }
        .product-title { font-weight: bold; font-size: 1rem; margin-bottom: 5px; height: 2.8em; overflow: hidden; }
        .product-price { color: var(--color-pink-hot); font-size: 1.1rem; font-weight: bold; }
        .btn-view { margin-top: 10px; background: var(--color-blue-light); border: none; padding: 8px; border-radius: 5px; width: 100%; font-weight: bold; cursor: pointer; }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; display: none;
            justify-content: center; align-items: center;
        }
        .modal-overlay.open { display: flex; }
        
        .modal-content {
            background: white; width: 95%; max-width: 900px; max-height: 90vh;
            border-radius: 20px; overflow-y: auto; padding: 0; position: relative;
            display: flex; flex-direction: column;
        }
        @media(min-width: 768px) { .modal-content { flex-direction: row; overflow: hidden; height: auto; min-height: 500px; } }

        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 2rem; cursor: pointer; color: #aaa; z-index: 10; line-height: 1; }

        /* å·¦å´åœ–ç‰‡å€ (æ”¯æ´å¤šåœ–) */
        .detail-img-area { flex: 1; background: #f9f9f9; display: flex; flex-direction: column; padding: 20px; }
        .main-img-box { flex: 1; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; overflow: hidden; border-radius: 10px; }
        .main-img { max-width: 100%; max-height: 350px; object-fit: contain; }
        
        .thumbnail-list { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; justify-content: center; }
        .thumb-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; cursor: pointer; border: 2px solid transparent; opacity: 0.6; transition: 0.2s; }
        .thumb-img.active { border-color: var(--color-pink-hot); opacity: 1; transform: scale(1.05); }

        /* å³å´è³‡è¨Šå€ */
        .detail-info { flex: 1.2; padding: 30px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .detail-title { font-size: 1.5rem; font-weight: bold; }
        .detail-desc { font-size: 0.95rem; color: #666; background: #f9f9f9; padding: 15px; border-radius: 10px; line-height: 1.6; }
        .detail-price { font-size: 1.8rem; color: var(--color-pink-hot); font-weight: bold; }
        .option-select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; }
        
        .qty-control { display: flex; align-items: center; gap: 15px; }
        .qty-btn { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #ddd; background: white; cursor: pointer; }
        .qty-input { width: 50px; text-align: center; border: none; font-size: 1.2rem; font-weight: bold; }
        .btn-add-cart { background: var(--color-pink-hot); color: white; border: none; padding: 15px; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: auto; }

        /* Cart Drawer & Float Button */
        .cart-drawer {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%;
            background: white; z-index: 2100; box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s; display: flex; flex-direction: column;
        }
        .cart-drawer.open { right: 0; }
        .cart-header { padding: 20px; background: var(--color-pink-hot); color: white; font-weight: bold; display: flex; justify-content: space-between; }
        .cart-body { flex: 1; padding: 20px; overflow-y: auto; }
        .cart-item { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px dashed #eee; padding-bottom: 15px; }
        .cart-item-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .cart-footer { padding: 20px; border-top: 1px solid #eee; }
        .btn-checkout { width: 100%; background: var(--color-purple); color: white; padding: 15px; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        
        .cart-float { position: fixed; bottom: 20px; right: 20px; background: var(--color-pink-hot); color: white; padding: 15px 25px; border-radius: 50px; cursor: pointer; z-index: 1000; display: flex; gap: 10px; font-weight: bold; box-shadow: 0 5px 20px rgba(255,107,107,0.4); }
        .cart-badge { background: white; color: var(--color-pink-hot); padding: 2px 8px; border-radius: 50%; }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-link">â€¹ å›é¦–é </a>
        <div class="page-title">ğŸ›ï¸ ç·šä¸Šå•†åŸ</div>
        <div style="width: 60px;"></div>
    </header>

    <div class="container">
        <div class="shop-grid" id="product-list"></div>
    </div>

    <div class="modal-overlay" id="productModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModalDirect()">Ã—</span>
            
            <div class="detail-img-area">
                <div class="main-img-box">
                    <img src="" class="main-img" id="modalMainImg">
                </div>
                <div class="thumbnail-list" id="modalThumbs">
                    </div>
            </div>

            <div class="detail-info">
                <div class="detail-title" id="modalTitle">å•†å“åç¨±</div>
                <div class="detail-price" id="modalPrice">NT$ 0</div>
                <div class="detail-desc" id="modalDesc"></div>
                
                <div>
                    <label style="font-weight:bold; display:block; margin-bottom:5px;">é¸æ“‡è¦æ ¼</label>
                    <select class="option-select" id="modalOption" onchange="updateModalPrice()"></select>
                </div>

                <div>
                    <label style="font-weight:bold; display:block; margin-bottom:5px;">æ•¸é‡</label>
                    <div class="qty-control">
                        <button class="qty-btn" onclick="changeModalQty(-1)">-</button>
                        <input type="text" class="qty-input" id="modalQty" value="1" readonly>
                        <button class="qty-btn" onclick="changeModalQty(1)">+</button>
                    </div>
                </div>

                <button class="btn-add-cart" onclick="addToCartFromModal()">åŠ å…¥è³¼ç‰©è»Š</button>
            </div>
        </div>
    </div>

    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-header">
            <span>ğŸ›’ è³¼ç‰©è»Š</span>
            <span style="cursor: pointer; font-size: 1.5rem;" onclick="toggleCart()">Ã—</span>
        </div>
        <div class="cart-body" id="cartList"></div>
        <div class="cart-footer">
            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; margin-bottom: 15px;">
                <span>ç¸½è¨ˆ</span><span id="drawerTotal">NT$ 0</span>
            </div>
            <button class="btn-checkout" onclick="goToCheckout()">å‰å¾€çµå¸³</button>
        </div>
    </div>

    <div class="cart-float" onclick="toggleCart()">
        <span>è³¼ç‰©è»Š</span><span class="cart-badge" id="floatCount">0</span>
    </div>

    <script>
        // â˜…â˜…â˜… å®Œæ•´ 12 é …å•†å“è³‡æ–™ (å«å¤šåœ–æ”¯æ´) â˜…â˜…â˜…
        // è«‹ç¢ºä¿è³‡æ–™å¤¾å…§æœ‰ p1.jpg ~ p12.jpg
        // â˜…â˜…â˜… å•†å“è³‡æ–™è¨­å®š (å¤šåœ–ç‰ˆ) â˜…â˜…â˜…
        const products = [
            { 
                id: 1, 
                name: "çµ²å…‰ç·šä¸€ç›’", 
                // çµ²å…‰ç·šå¦‚æœä¹Ÿæœ‰è‰²å¡ï¼Œä¹Ÿå¯ä»¥åƒé€™æ¨£åŠ é€²å»
                images: ["p1.jpg"], 
                desc: "è®“äº”å®˜ç¹¡è£½èµ·ä¾†æ›´æœ‰å…‰æ¾¤ã€ç«‹é«”æ„Ÿã€‚<br>æä¾›å¤šç¨®è‰²ç³»é¸æ“‡ã€‚", 
                basePrice: 200, 
                options: [
                    {name:"åŸºç¤å¸¸ç”¨è‰²36ç¨®", price:200},
                    {name:"ç´…è‰²ç³»36ç¨®", price:200},
                    {name:"é»ƒè‰²ç³»36ç¨®", price:200},
                    {name:"æ£•è‰²ç³»36ç¨®", price:200},
                    {name:"è—è‰²ç³»36ç¨®", price:200},
                    {name:"ç¶ è‰²ç³»36ç¨®", price:200},
                    {name:"ç´«è‰²ç³»36ç¨®", price:200},
                    {name:"ç‰¹æ®Šé»‘ç™½è‰²ç³»36ç¨®", price:200},
                    {name:"å…¨252ç¨® (å¤§å…¨å¥—)", price:1350}
                ] 
            },
            { 
                id: 2, 
                name: "5mm æ°´æ™¶è¶…æŸ”å¸ƒæ–™", 
                // â˜… ä¿®æ”¹é€™è£¡ï¼šåŠ å…¥ p2-color.jpg
                images: ["p2.jpg", "p2-color.jpg"], 
                desc: "<b>æœ‰æ¯›æµæ„Ÿçš„é ­é«®</b><br>å°ºå¯¸ï¼š50x50cm / ä¸€å¡Š<br>âš ï¸ è«‹å‚™è¨»è‰²è™Ÿã€‚", 
                basePrice: 30, 
                options: [{name:"ä¸€å¡Š (å‚™è¨»è‰²è™Ÿ)", price:30}] 
            },
            { 
                id: 3, 
                name: "1mm æ°´æ™¶è¶…æŸ”å¸ƒæ–™", 
                // â˜… ä¿®æ”¹é€™è£¡ï¼šåŠ å…¥ p3-color.jpg
                images: ["p3.jpg", "p2-color.jpg"], 
                desc: "<b>çš®è†šå¸ƒæ–™ / é€ å‹çŸ­é«®</b><br>å°ºå¯¸ï¼š50x50cm / ä¸€å¡Š<br>âš ï¸ è«‹å‚™è¨»è‰²è™Ÿã€‚", 
                basePrice: 30, 
                options: [{name:"ä¸€å¡Š (å‚™è¨»è‰²è™Ÿ)", price:30}] 
            },
            { 
                id: 4, 
                name: "é•·æ¯›çµ¨å¸ƒæ–™", 
                // â˜… ä¿®æ”¹é€™è£¡ï¼šåŠ å…¥ p2-color.jpg
                images: ["p4.jpg", "p2-color.jpg"], 
                desc: "<b>è£½ä½œé•·é«®å°ˆç”¨</b><br>å°ºå¯¸ï¼š25x50cm / ä¸€å¡Š<br>âš ï¸ è«‹å‚™è¨»è‰²è™Ÿã€‚", 
                basePrice: 55, 
                options: [{name:"ä¸€å¡Š (å‚™è¨»è‰²è™Ÿ)", price:55}] 
            },
            { 
                id: 5, 
                name: "ä»¿å…”æ¯›å¸ƒæ–™", 
                // â˜… ä¿®æ”¹é€™è£¡ï¼šåŠ å…¥ p2-color.jpg
                images: ["p5.jpg", "p2-color.jpg"], 
                desc: "<b>ç‰¹æ®Šé ­é«®è³ªæ„Ÿ</b><br>å°ºå¯¸ï¼š50x50cm / ä¸€å¡Š<br>âš ï¸ è«‹å‚™è¨»è‰²è™Ÿã€‚", 
                basePrice: 40, 
                options: [{name:"ä¸€å¡Š (å‚™è¨»è‰²è™Ÿ)", price:40}] 
            },
            { 
                id: 6, 
                name: "å·æ¯›å¸ƒæ–™", 
                // â˜… ä¿®æ”¹é€™è£¡ï¼šåŠ å…¥ p2-color.jpg
                images: ["p6.jpg", "p2-color.jpg"], 
                desc: "<b>ç‰¹æ®Šæ²é«®é€ å‹</b><br>å°ºå¯¸ï¼š50x50cm / ä¸€å¡Š<br>âš ï¸ è«‹å‚™è¨»è‰²è™Ÿã€‚", 
                basePrice: 60, 
                options: [{name:"ä¸€å¡Š (å‚™è¨»è‰²è™Ÿ)", price:60}] 
            },
            { 
                id: 7, 
                name: "æ¶ˆè‰²ç­† (æ°´æ¶ˆ/ç†±æ¶ˆ)", 
                images: ["p7.jpg"], 
                desc: "<b>ç•«äº”å®˜æˆ–ç‰ˆå‹å¿…å‚™</b><br>æ°´æ¶ˆï¼šé‡æ°´å³æ¶ˆ<br>ç†±æ¶ˆï¼šé‡ç†±(å¹é¢¨æ©Ÿ)å³æ¶ˆ", 
                basePrice: 30, 
                options: [
                    { name: "æ°´æ¶ˆç­† - ç´…è‰²", price: 30 },
                    { name: "æ°´æ¶ˆç­† - é»‘è‰²", price: 30 },
                    { name: "æ°´æ¶ˆç­† - è—è‰²", price: 30 },
                    { name: "æ°´æ¶ˆç­† - ç™½è‰²", price: 30 },
                    { name: "ç†±æ¶ˆç­† - ç´…è‰²", price: 30 },
                    { name: "ç†±æ¶ˆç­† - é»‘è‰²", price: 30 },
                    { name: "ç†±æ¶ˆç­† - è—è‰²", price: 30 },
                    { name: "ç†±æ¶ˆç­† - ç™½è‰²", price: 30 }
                ] 
            },
            { 
                id: 8, 
                name: "åˆºç¹¡æ¡†", 
                images: ["p8.jpg"], 
                desc: "å›ºå®šå¸ƒæ–™ç”¨ï¼Œåˆºç¹¡å¿…å‚™ã€‚", 
                basePrice: 40, 
                options: [
                    {name:"4å‹ (ç´„10cm)", price:40},
                    {name:"5å‹ (ç´„12cm)", price:40},
                    {name:"6å‹ (ç´„15cm)", price:45},
                    {name:"7å‹ (ç´„18cm)", price:45}
                ] 
            },
            { 
                id: 9, 
                name: "æ°´æº¶è†œ", 
                images: ["p9.jpg"], 
                desc: "æåœ–ç”¨ï¼Œä¸€åŒ…5å¼µ (25x25cm)ã€‚", 
                basePrice: 25, 
                options: [{name:"ä¸€åŒ… 5 å¼µ", price:25}] 
            },
            { 
                id: 10, 
                name: "ç¹¡èŠ±é‡åŒ…", 
                images: ["p10.jpg"], 
                desc: "å°ˆç”¨é‡å…·ã€‚<br>10è™Ÿé‡ï¼šåˆºç¹¡ç”¨ (ç´°)<br>5è™Ÿé‡ï¼šç¸«åˆç”¨ (ç²—)", 
                basePrice: 30, 
                options: [
                    {name:"10è™Ÿç¹¡èŠ±é‡ (åˆºç¹¡)", price:30},
                    {name:"5è™Ÿç¹¡èŠ±é‡ (ç¸«åˆ)", price:30}
                ] 
            },
            { 
                id: 11, 
                name: "æ£‰èŠ± (çç æ£‰)", 
                images: ["p11.jpg"], 
                desc: "å¡«å……å°ˆç”¨é«˜å½ˆæ£‰èŠ±ã€‚", 
                basePrice: 75, 
                options: [{name:"500å…‹ / åŒ…", price:75}] 
            },
            { 
                id: 12, 
                name: "æ–°æ‰‹ä¸€ç«™åˆ°ä½ææ–™åŒ…", 
                images: ["p12.jpg"], 
                desc: "<b>å«å¯åšå…©éš»20cmå¨ƒçš„ææ–™ + å½±ç‰‡</b><br>å…§å®¹ï¼šçµ²å…‰ç·š36è‰²ã€5mmæ°´æ™¶çµ¨x3ã€1mmçš®è†šè‰²x1ã€ç†±æ¶ˆç­†x1ã€6å‹ç¹¡æ¡†ã€æ°´æº¶è†œã€é‡åŒ…çµ„ã€æ£‰èŠ±500gã€ç‰ˆå‹ã€‚", 
                basePrice: 650, 
                options: [{name:"æ¨™æº–æ–°æ‰‹å¥—çµ„", price:650}] 
            }
        ];

        let cart = JSON.parse(localStorage.getItem('shopCart')) || [];
        let currentProduct = null;

        function initShop() {
            document.getElementById('product-list').innerHTML = products.map(p => `
                <div class="product-card" onclick="openModal(${p.id})">
                    <img src="${p.images[0]}" class="product-img" onerror="this.src='https://placehold.co/400?text=No+Image'">
                    <div class="product-title">${p.name}</div>
                    <div class="product-price">NT$ ${p.basePrice} èµ·</div>
                    <button class="btn-view">æŸ¥çœ‹è©³æƒ…</button>
                </div>
            `).join('');
            updateCartIcon();
        }

        function openModal(id) {
            currentProduct = products.find(p => p.id === id);
            if(!currentProduct) return;

            document.getElementById('modalTitle').innerText = currentProduct.name;
            document.getElementById('modalDesc').innerHTML = currentProduct.desc;
            
            // --- åœ–ç‰‡é‚è¼¯ ---
            const mainImg = document.getElementById('modalMainImg');
            const thumbBox = document.getElementById('modalThumbs');
            
            mainImg.src = currentProduct.images[0]; // é è¨­ç¬¬ä¸€å¼µ
            
            // ç”¢ç”Ÿç¸®åœ–
            if (currentProduct.images.length > 1) {
                thumbBox.style.display = 'flex';
                thumbBox.innerHTML = currentProduct.images.map((img, idx) => `
                    <img src="${img}" class="thumb-img ${idx===0?'active':''}" onclick="switchImage('${img}', this)">
                `).join('');
            } else {
                thumbBox.style.display = 'none';
            }

            const select = document.getElementById('modalOption');
            select.innerHTML = currentProduct.options.map((opt, idx) => `<option value="${idx}" data-price="${opt.price}">${opt.name} - $${opt.price}</option>`).join('');
            
            document.getElementById('modalQty').value = 1;
            updateModalPrice();
            document.getElementById('productModal').classList.add('open');
        }

        function switchImage(src, element) {
            document.getElementById('modalMainImg').src = src;
            document.querySelectorAll('.thumb-img').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
        }

        function closeModalDirect() { document.getElementById('productModal').classList.remove('open'); }
        function closeModal(e) { if(e.target.classList.contains('modal-overlay')) closeModalDirect(); }
        function updateModalPrice() {
            const sel = document.getElementById('modalOption');
            document.getElementById('modalPrice').innerText = `NT$ ${sel.options[sel.selectedIndex].dataset.price}`;
        }
        function changeModalQty(d) {
            const ipt = document.getElementById('modalQty');
            let v = parseInt(ipt.value) + d;
            if(v < 1) v = 1;
            ipt.value = v;
        }
        function addToCartFromModal() {
            const idx = document.getElementById('modalOption').value;
            const opt = currentProduct.options[idx];
            const qty = parseInt(document.getElementById('modalQty').value);
            
            const exist = cart.find(i => i.id === currentProduct.id && i.option === opt.name);
            if(exist) exist.qty += qty;
            else cart.push({ id: currentProduct.id, name: currentProduct.name, img: currentProduct.images[0], option: opt.name, price: opt.price, qty: qty });
            
            saveCart(); closeModalDirect(); toggleCart(true);
        }

        function toggleCart(forceOpen) {
            const drawer = document.getElementById('cartDrawer');
            if(forceOpen || !drawer.classList.contains('open')) {
                drawer.classList.add('open'); renderCartList();
            } else drawer.classList.remove('open');
        }
        function renderCartList() {
            const list = document.getElementById('cartList');
            let total = 0;
            if(cart.length === 0) { list.innerHTML = '<p style="text-align:center;color:#888;margin-top:20px;">ç©ºçš„</p>'; }
            else {
                list.innerHTML = cart.map((item, i) => {
                    total += item.price * item.qty;
                    return `
                    <div class="cart-item">
                        <img src="${item.img}" class="cart-item-img">
                        <div style="flex:1">
                            <div>${item.name}</div>
                            <div style="font-size:0.85rem;color:#888;">${item.option}</div>
                            <div style="color:var(--color-pink-hot);font-weight:bold;">$${item.price}</div>
                            <div style="margin-top:5px;">
                                <button onclick="updateCartItem(${i}, -1)">-</button> ${item.qty} <button onclick="updateCartItem(${i}, 1)">+</button> 
                                <span style="font-size:0.8rem;margin-left:10px;cursor:pointer;" onclick="removeCartItem(${i})">ç§»é™¤</span>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            }
            document.getElementById('drawerTotal').innerText = `NT$ ${total}`;
        }
        function updateCartItem(i, d) { cart[i].qty += d; if(cart[i].qty < 1) cart[i].qty = 1; saveCart(); renderCartList(); }
        function removeCartItem(i) { cart.splice(i, 1); saveCart(); renderCartList(); }
        function saveCart() { localStorage.setItem('shopCart', JSON.stringify(cart)); updateCartIcon(); }
        function updateCartIcon() { document.getElementById('floatCount').innerText = cart.reduce((s,i)=>s+i.qty,0); }
        
        function goToCheckout() {
            if(cart.length === 0) { alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„'); return; }
            localStorage.removeItem('bookingData'); // æ¸…é™¤é ç´„è³‡æ–™ï¼Œç´”è³¼ç‰©
            window.location.href = 'payment.html';
        }
        initShop();
    </script>
</body>
</html>